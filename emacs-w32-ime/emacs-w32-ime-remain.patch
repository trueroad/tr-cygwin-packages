Part of rzl24ozi/emacs-26.1-rc1-w32-ime.diff
https://gist.github.com/rzl24ozi/ee4457df2f54c5f3ca0d02b56e371233

--- ./lisp/language/japan-util.el.orig	2018-01-09 05:23:57.000000000 +0900
+++ ./lisp/language/japan-util.el	2018-04-10 23:10:39.781015100 +0900
@@ -31,9 +31,11 @@
 (defun setup-japanese-environment-internal ()
   ;; By default, we use 'japanese-iso-8bit for file names.  But, the
   ;; following prefer-coding-system will override it.
-  (if (memq system-type '(windows-nt ms-dos cygwin))
+  (if (memq system-type '(windows-nt ms-dos))
       (prefer-coding-system 'japanese-shift-jis)
-    (prefer-coding-system 'japanese-iso-8bit))
+    (if (eq system-type 'cygwin)
+        (prefer-coding-system 'utf-8)
+        (prefer-coding-system 'japanese-iso-8bit)))
   (use-cjk-char-width-table 'ja_JP))
 
 (defconst japanese-kana-table
--- ./lisp/loadup.el.orig	2018-01-09 05:23:57.000000000 +0900
+++ ./lisp/loadup.el	2018-04-10 23:10:39.791037100 +0900
@@ -283,6 +283,7 @@
       (load "w32-vars")
       (load "term/w32-win")
       (load "disp-table")
+      (load "international/w32-ime")
       (when (eq system-type 'windows-nt)
         (load "w32-fns")
         (load "ls-lisp")
--- ./lisp/startup.el.orig	2018-03-13 00:59:18.000000000 +0900
+++ ./lisp/startup.el	2018-04-10 23:10:39.801059200 +0900
@@ -596,6 +596,8 @@
     ;; `user-full-name' is now known; reset its standard-value here.
     (put 'user-full-name 'standard-value
 	 (list (default-value 'user-full-name)))
+    ;; Set language environment for using "Japanese".
+    (set-language-environment "Japanese")
     ;; If the PWD environment variable isn't accurate, delete it.
     (let ((pwd (getenv "PWD")))
       (and (stringp pwd)
